
<div class="video-header wrap">
  <div class = "fullscreen-video-wrap">
    <video autoplay playsinline muted loop preload>
      <source src="https://res.cloudinary.com/patti01/video/upload/v1560159084/crowd_dniwdh.mp4">
    </video>
  </div>

    <div class="main-container">
      <div class="header">
        <h1>  </h1>
      </div>
      <div class="bull-bar-container">
        <a id="bull-bar">
          <p>- - - - -</p>
        </a>
      </div>
      <div class="spinner">
        <%= image_tag "spinner3.png", id:"spinner-img" %>
          <h1 id="btn-spinner" data-project="<%= @projects.to_json %>">

        </h1>
      </div>
    </div>

</div>






    <!-- SPIN SCRIPT -->
    <script>
      // random degree function (n = number of spins)
      const randomExtraSpins = n => Math.random()*n*360;

      // initialize degrees
      const minSpinDegrees = 5 * 360; // 5 spins minimum!
      let degreeSpinSum = normalize(minSpinDegrees + randomExtraSpins(3)); // 3 extra spins max!

      // initialize DOM objects
      const button = document.getElementById("btn-spinner");
      const spinner = document.getElementById("spinner-img");
      const bullbar = document.getElementById("bull-bar");

      // ON BUTTON CLICK -> SPIN THE WHEEL!
      button.addEventListener('click', (event) => {
        console.log("DEGREE SPIN SUM");
        console.log(degreeSpinSum);
        // reset
        bullbar.setAttribute("style", "border: none;");
        spinner.innerHTML = "";
        bullbar.innerHTML = "- - - - -";
        // calculate spinner degrees and spin! (transformation)
        degreeSpinSum += normalize(minSpinDegrees + randomExtraSpins(3));
        const selectedBezier = selectBezier();
        console.log(selectedBezier);
        let buildStyle = `transform: rotate(${degreeSpinSum}deg); transition-timing-function: ${selectedBezier}`;
        spinner.setAttribute("style", buildStyle);
      });

      // ADD EVENTLISTENERS FOR "transitioned" event! (loop over all types of transitioned)
      "transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd".split(" ").forEach((event) => {
        spinner.addEventListener(event, () => { // webkitTransitionEnd oTransitionEnd MSTransitionEnd"
          bullbar.innerHTML = `${bullName()}`;
          bullbar.setAttribute("style", "border: 0px solid ; transition: ease 0.25s;");
          button.innerHTML = "";
        });
      })

      /*
       * SELECT BEZIER
       * randomly picks one predefined bezier transition function
       * resources used: https://codepen.io/Guilh/full/ZQxoOX/
       */
      function selectBezier() {
        let sampleArray = [
          "cubic-bezier(0.6, 1.5, 0.6, 1)",
          "cubic-bezier(.1, .9, .9, .1)",
          "cubic-bezier(0.68, -0.55, 0.265, 1.55)",
          "cubic-bezier(0.25, 0. 1, 0.25, 1)"
        ];
        return sampleArray[Math.floor(Math.random() * sampleArray.length)];
      }

      /*
       * NORMALIZE
       * lets the wheel stop at certain splitpoints (determined by nbrOfSplitpoints!)
       */
      function normalize(input) {
        const nbrOdSplitpoints = 8;
        const interval = 360 / nbrOdSplitpoints;
        return Math.floor(input/interval)*interval;
      }

    </script>

    <script>


      const nouns = [
        "THIS MISSION WOULD BE PERFECT",

      ];

      const capitalize = (string) => {
        return string[0].toUpperCase() + string.substring(1)
      };

      const bullName = () => {
        // const seedNoun = Math.floor(Math.random() * nouns.length);
        // return capitalize(nouns[seedNoun]);
        // const charities = document.getElementById("btn-spinner").dataset.charity
        // console.log(charities);
        const result = JSON.parse(document.getElementById("btn-spinner").dataset.project)[Math.floor(Math.random() * 9) + 1  ];
        const name = result.name
        const url = result.url
        return `<a href=${url}>${name}</a>`;
      };

    </script>


